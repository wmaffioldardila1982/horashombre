<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Horas Hombre - Google Sheets</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab-button {
            background: white;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            border-radius: 25px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-weight: 500;
        }

        .tab-button:hover {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
        }

        .tab-button.active {
            background: #2980b9;
            color: white;
            box-shadow: 0 4px 15px rgba(41, 128, 185, 0.3);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.8em;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 5px;
            font-weight: 600;
            color: #34495e;
        }

        .form-control {
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        th {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.success { background: #2ecc71; }
        .notification.error { background: #e74c3c; }
        .notification.info { background: #3498db; }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2.5em;
            margin: 0;
        }

        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mb-3 { margin-bottom: 1rem; }

        /* Estilos para la nueva pesta√±a de Trabajadores por Cargo */
        .filters-container {
            display: flex;
            gap: 20px;
            align-items: end;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 150px;
        }

        .filter-group label {
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .stats-summary {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .total-row {
            background-color: #f8f9fa !important;
            font-weight: bold;
            border-top: 2px solid #007bff;
        }

        .total-row td {
            padding: 12px !important;
        }

        @media (max-width: 768px) {
            .container { padding: 10px; }
            .header h1 { font-size: 2em; }
            .tabs { flex-direction: column; }
            .tab-button { width: 100%; }
            .form-grid { grid-template-columns: 1fr; }
            .filters-container { flex-direction: column; align-items: stretch; }
            .filter-group { min-width: 100%; }
            .stats-summary { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Control de Horas Hombre</h1>
            <p>Sistema integrado con Google Sheets</p>
        </div>

        <!-- Pesta√±as de navegaci√≥n -->
        <div class="tabs">
            <button class="tab-button active" onclick="showTab('config')">‚öôÔ∏è Configuraci√≥n</button>
            <button class="tab-button" onclick="showTab('registro')">üìù Registro</button>
            <button class="tab-button" onclick="showTab('trabajadores')">üë• Trabajadores</button>
            <button class="tab-button" onclick="showTab('estadisticas')">üìä Estad√≠sticas</button>
            <button class="tab-button" onclick="showTab('trabajadores-cargo')">üîç Trabajadores por Cargo</button>
            <button class="tab-button" onclick="showTab('datos')">üìã Datos Detallados</button>
        </div>

        <!-- Pesta√±a de Configuraci√≥n -->
        <div id="config" class="tab-content active">
            <div class="card">
                <h2>‚öôÔ∏è Configuraci√≥n de Google Sheets</h2>
                
                <div class="mb-3">
                    <h3>üìã Instrucciones de Configuraci√≥n</h3>
                    <ol>
                        <li><strong>Crea una copia de la plantilla de Google Sheets:</strong><br>
                            <a href="https://docs.google.com/spreadsheets/d/1abc123/copy" target="_blank" class="btn btn-primary">
                                üìÑ Haz clic aqu√≠ para copiar la plantilla
                            </a><br>
                            <small>(Se abrir√° una copia en tu Google Drive)</small>
                        </li>
                        <li><strong>Abre tu copia y ve a:</strong> Extensiones ‚Üí Apps Script</li>
                        <li><strong>Copia y pega este c√≥digo en el editor de Apps Script:</strong>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0; overflow-x: auto;">
                                <pre style="font-size: 12px; line-height: 1.4;">
function doGet(e) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet();
  const action = e.parameter.action;
  
  if (action === 'getTrabajadores') {
    const data = sheet.getSheetByName('Trabajadores').getDataRange().getValues();
    return ContentService.createTextOutput(JSON.stringify(data.slice(1)))
      .setMimeType(ContentService.MimeType.JSON);
  }
  
  if (action === 'getRegistros') {
    const data = sheet.getSheetByName('Registros').getDataRange().getValues();
    return ContentService.createTextOutput(JSON.stringify(data.slice(1)))
      .setMimeType(ContentService.MimeType.JSON);
  }
  
  if (action === 'getTrabajadoresPorCargo') {
    const fechaInicio = e.parameter.fechaInicio;
    const fechaFin = e.parameter.fechaFin;
    
    const trabajadoresSheet = sheet.getSheetByName('Trabajadores');
    const registrosSheet = sheet.getSheetByName('Registros');
    
    const trabajadores = trabajadoresSheet.getDataRange().getValues().slice(1);
    const registros = registrosSheet.getDataRange().getValues().slice(1);
    
    const registrosFiltrados = registros.filter(registro => {
      const fechaRegistro = new Date(registro[1]);
      const inicio = new Date(fechaInicio);
      const fin = new Date(fechaFin);
      return fechaRegistro >= inicio && fechaRegistro <= fin;
    });
    
    const cedulasActivas = [...new Set(registrosFiltrados.map(r => r[3]))];
    const trabajadoresActivos = trabajadores.filter(t => cedulasActivas.includes(t[0]));
    
    const conteoporCargo = {};
    trabajadoresActivos.forEach(trabajador => {
      const cargo = trabajador[2];
      const tipoCargo = trabajador[3];
      
      if (!conteoporCargo[cargo]) {
        conteoporCargo[cargo] = { cargo: cargo, directa: 0, indirecta: 0, total: 0 };
      }
      
      if (tipoCargo === 'Directa') {
        conteoporCargo[cargo].directa++;
      } else if (tipoCargo === 'Indirecta') {
        conteoporCargo[cargo].indirecta++;
      }
      conteoporCargo[cargo].total++;
    });
    
    return ContentService.createTextOutput(JSON.stringify({
      success: true,
      data: Object.values(conteoporCargo),
      periodo: { inicio: fechaInicio, fin: fechaFin },
      totalTrabajadores: trabajadoresActivos.length
    })).setMimeType(ContentService.MimeType.JSON);
  }
  
  return ContentService.createTextOutput(JSON.stringify({error: 'Acci√≥n no v√°lida'}))
    .setMimeType(ContentService.MimeType.JSON);
}

function doPost(e) {
  try {
    const sheet = SpreadsheetApp.getActiveSpreadsheet();
    const data = JSON.parse(e.postData.contents);
    
    if (data.action === 'addTrabajador') {
      const ws = sheet.getSheetByName('Trabajadores');
      ws.appendRow([data.cedula, data.nombreCompleto, data.cargo, data.tipoCargo, data.fechaIngreso, data.fechaRetiro || '']);
      return ContentService.createTextOutput(JSON.stringify({success: true}))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    if (data.action === 'addRegistro') {
      const ws = sheet.getSheetByName('Registros');
      let idFinal = data.id;
      if (!idFinal || idFinal === 'SIN_ID' || idFinal.toString().trim() === '') {
        idFinal = 'REG_' + new Date().getTime() + '_' + Math.random().toString(36).substr(2, 9);
      }
      
      ws.appendRow([idFinal, data.fecha, data.trabajadorNombre, data.trabajadorCedula, data.frente, data.horasDirecta, data.horasIndirecta]);
      return ContentService.createTextOutput(JSON.stringify({success: true, id: idFinal}))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    // M√°s funciones aqu√≠...
    
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({error: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}
                                </pre>
                            </div>
                        </li>
                        <li><strong>Guarda el proyecto</strong> (icono de disquete)</li>
                        <li><strong>Haz clic en "Implementar" ‚Üí "Nueva implementaci√≥n"</strong></li>
                        <li><strong>Selecciona tipo:</strong> "Aplicaci√≥n web"</li>
                        <li><strong>Configuraci√≥n:</strong>
                            <ul>
                                <li>Ejecutar como: Yo</li>
                                <li>Qui√©n tiene acceso: Cualquier persona</li>
                            </ul>
                        </li>
                        <li><strong>Autoriza el acceso</strong> (la primera vez te pedir√° permisos)</li>
                        <li><strong>Copia la URL que te da</strong> (termina en /exec)</li>
                        <li><strong>P√©gala abajo y guarda la configuraci√≥n</strong></li>
                    </ol>
                    <div class="notification info">
                        <strong>Importante:</strong> La URL debe terminar en /exec (no en /dev)
                    </div>
                </div>

                <div class="form-group">
                    <label for="apiUrl">URL de tu Web App de Google Sheets:</label>
                    <input type="url" id="apiUrl" class="form-control" 
                           placeholder="https://script.google.com/macros/s/tu-id/exec">
                </div>
                
                <div style="margin-top: 20px;">
                    <button onclick="saveConfig()" class="btn btn-success">üíæ Guardar y Probar Conexi√≥n</button>
                    <button onclick="createTemplate()" class="btn btn-secondary">üìä Crear Plantilla Manual</button>
                </div>
                
                <div id="connectionStatus" style="margin-top: 20px;"></div>
            </div>
        </div>

        <!-- Pesta√±a de Registro -->
        <div id="registro" class="tab-content">
            <div class="card">
                <h2>üìù Registrar Horas</h2>
                
                <div class="tabs" style="margin-bottom: 20px;">
                    <button class="tab-button active" onclick="showSubTab('registro-simple')">Registro Simple</button>
                    <button class="tab-button" onclick="showSubTab('registro-masivo')">Registro Masivo</button>
                    <button class="tab-button" onclick="showSubTab('importar-excel')">Importar Excel</button>
                </div>

                <!-- Registro Simple -->
                <div id="registro-simple" class="sub-tab-content active">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="fecha">Fecha:</label>
                            <input type="date" id="fecha" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="trabajador">Trabajador:</label>
                            <select id="trabajador" class="form-control">
                                <option value="">-- Seleccione un trabajador --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="frente">Frente de Trabajo:</label>
                            <input type="text" id="frente" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="horasDirecta">Horas Directa:</label>
                            <input type="number" id="horasDirecta" class="form-control" step="0.5" min="0" max="24">
                        </div>
                        <div class="form-group">
                            <label for="horasIndirecta">Horas Indirecta:</label>
                            <input type="number" id="horasIndirecta" class="form-control" step="0.5" min="0" max="24">
                        </div>
                    </div>
                    
                    <button onclick="addRegistro()" class="btn btn-primary">‚úÖ Agregar Registro</button>
                    <button onclick="loadData()" class="btn btn-secondary">üîÑ Sincronizar</button>
                </div>

                <!-- Registro Masivo -->
                <div id="registro-masivo" class="sub-tab-content">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="fechaMasiva">Fecha:</label>
                            <input type="date" id="fechaMasiva" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="frenteMasivo">Frente de Trabajo:</label>
                            <input type="text" id="frenteMasivo" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="horasDirectaMasiva">Horas Directa (por defecto):</label>
                            <input type="number" id="horasDirectaMasiva" class="form-control" step="0.5" min="0" max="24" value="8">
                        </div>
                        <div class="form-group">
                            <label for="horasIndirectaMasiva">Horas Indirecta (por defecto):</label>
                            <input type="number" id="horasIndirectaMasiva" class="form-control" step="0.5" min="0" max="24" value="0">
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <label>Selecciona los trabajadores:</label>
                        <div style="margin: 10px 0;">
                            <button onclick="selectAllWorkers()" class="btn btn-secondary">‚úÖ Seleccionar Todos</button>
                            <button onclick="deselectAllWorkers()" class="btn btn-secondary">‚ùå Deseleccionar Todos</button>
                        </div>
                        <div id="workersList" class="form-control" style="height: 200px; overflow-y: auto; padding: 10px;">
                        </div>
                    </div>
                    
                    <button onclick="addRegistroMasivo()" class="btn btn-success">üìù Registrar Todos</button>
                    <button onclick="cancelMasivo()" class="btn btn-secondary">‚ùå Cancelar</button>
                </div>

                <!-- Importar Excel -->
                <div id="importar-excel" class="sub-tab-content">
                    <div class="form-group">
                        <label for="excelFile">Archivo Excel:</label>
                        <input type="file" id="excelFile" class="form-control" accept=".xlsx,.xls">
                    </div>
                    <button onclick="importExcel()" class="btn btn-warning">üìä Importar Excel</button>
                    <div id="importStatus"></div>
                </div>
            </div>
        </div>

        <!-- Pesta√±a de Trabajadores -->
        <div id="trabajadores" class="tab-content">
            <div class="card">
                <h2>üë• Gesti√≥n de Trabajadores</h2>
                
                <div style="margin-bottom: 20px;">
                    <button onclick="showModal('modalTrabajador')" class="btn btn-primary">‚ûï Nuevo Trabajador</button>
                    <button onclick="loadData()" class="btn btn-secondary">üîÑ Sincronizar</button>
                </div>
                
                <div class="table-container">
                    <table id="tablaTrabajadores">
                        <thead>
                            <tr>
                                <th>C√©dula</th>
                                <th>Nombre Completo</th>
                                <th>Cargo</th>
                                <th>Tipo de Cargo</th>
                                <th>Fecha Ingreso</th>
                                <th>Fecha Retiro</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="bodyTrabajadores">
                            <tr>
                                <td colspan="8" class="text-center">Cargando trabajadores...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Pesta√±a de Estad√≠sticas -->
        <div id="estadisticas" class="tab-content">
            <div class="card">
                <h2>üìä Estad√≠sticas del Proyecto</h2>
                
                <div class="form-grid mb-3">
                    <div class="form-group">
                        <label for="fechaDesde">Per√≠odo desde:</label>
                        <input type="date" id="fechaDesde" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="fechaHasta">hasta:</label>
                        <input type="date" id="fechaHasta" class="form-control">
                    </div>
                    <div class="form-group">
                        <button onclick="updateStats()" class="btn btn-primary" style="align-self: end;">üîÑ Actualizar</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="tablaEstadisticas">
                        <thead>
                            <tr>
                                <th rowspan="2">FRENTE</th>
                                <th rowspan="2">CANTIDAD DE PERSONAL</th>
                                <th colspan="2">CANTIDAD DE HH</th>
                                <th colspan="2">PER√çODO</th>
                                <th colspan="2">ACUMULADO</th>
                            </tr>
                            <tr>
                                <th>DIRECTA</th>
                                <th>INDIRECTA</th>
                                <th>DIRECTA</th>
                                <th>INDIRECTA</th>
                                <th>DIRECTA</th>
                                <th>INDIRECTA</th>
                            </tr>
                        </thead>
                        <tbody id="bodyEstadisticas">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Nueva pesta√±a: Trabajadores por Cargo -->
        <div id="trabajadores-cargo" class="tab-content">
            <div class="card">
                <h2>üîç An√°lisis de Trabajadores por Cargo</h2>
                <p>Consulta la cantidad de trabajadores por cargo en un per√≠odo espec√≠fico</p>
                
                <!-- Filtros de fecha -->
                <div class="filters-container">
                    <div class="filter-group">
                        <label for="fechaInicioCargo">Fecha Inicio:</label>
                        <input type="date" id="fechaInicioCargo" class="form-control">
                    </div>
                    <div class="filter-group">
                        <label for="fechaFinCargo">Fecha Fin:</label>
                        <input type="date" id="fechaFinCargo" class="form-control">
                    </div>
                    <div class="filter-group">
                        <button onclick="consultarTrabajadoresPorCargo()" class="btn btn-primary">
                            üîç Consultar
                        </button>
                        <button onclick="exportarTrabajadoresCargo()" class="btn btn-secondary">
                            üìä Exportar a Excel
                        </button>
                    </div>
                </div>
                
                <!-- Resumen -->
                <div id="resumenCargo" class="stats-summary" style="display: none;">
                    <div class="stat-card">
                        <h3 id="totalTrabajadoresConsulta">0</h3>
                        <p>Total Trabajadores Activos</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalCargosDiferentes">0</h3>
                        <p>Cargos Diferentes</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="rangoFechasConsulta">-</h3>
                        <p>Per√≠odo Consultado</p>
                    </div>
                </div>
                
                <!-- Tabla de resultados -->
                <div class="table-container">
                    <table id="tablaTrabajadoresCargo">
                        <thead>
                            <tr>
                                <th>Cargo</th>
                                <th>Personal Directa</th>
                                <th>Personal Indirecta</th>
                                <th>Total Personal</th>
                                <th>% Directa</th>
                                <th>% Indirecta</th>
                            </tr>
                        </thead>
                        <tbody id="bodyTrabajadoresCargo">
                            <tr>
                                <td colspan="6" class="text-center">
                                    Selecciona un rango de fechas y haz clic en "Consultar"
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Pesta√±a de Datos Detallados -->
        <div id="datos" class="tab-content">
            <div class="card">
                <h2>üìã Registros Detallados</h2>
                
                <div class="table-container">
                    <table id="tablaRegistros">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Trabajador</th>
                                <th>C√©dula</th>
                                <th>Frente</th>
                                <th>Horas Directa</th>
                                <th>Horas Indirecta</th>
                                <th>Total Horas</th>
                                <th>Acci√≥n</th>
                            </tr>
                        </thead>
                        <tbody id="bodyRegistros">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Trabajador -->
    <div id="modalTrabajador" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Nuevo Trabajador</h3>
                <span class="close" onclick="hideModal('modalTrabajador')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="modalCedula">N√∫mero de C√©dula:</label>
                    <input type="text" id="modalCedula" class="form-control">
                </div>
                <div class="form-group">
                    <label for="modalNombre">Nombre Completo:</label>
                    <input type="text" id="modalNombre" class="form-control">
                </div>
                <div class="form-group">
                    <label for="modalCargo">Cargo:</label>
                    <input type="text" id="modalCargo" class="form-control">
                </div>
                <div class="form-group">
                    <label for="modalTipoCargo">Tipo de Cargo:</label>
                    <select id="modalTipoCargo" class="form-control">
                        <option value="">-- Seleccione --</option>
                        <option value="Directa">Directa</option>
                        <option value="Indirecta">Indirecta</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="modalFechaIngreso">Fecha de Ingreso:</label>
                    <input type="date" id="modalFechaIngreso" class="form-control">
                </div>
                <div class="form-group">
                    <label for="modalFechaRetiro">Fecha de Retiro (opcional):</label>
                    <input type="date" id="modalFechaRetiro" class="form-control">
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="saveTrabajador()" class="btn btn-success">üíæ Guardar Trabajador</button>
                <button onclick="hideModal('modalTrabajador')" class="btn btn-secondary">‚ùå Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        let API_URL = '';
        let trabajadores = [];
        let registros = [];
        let editingWorker = null;

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            loadConfig();
            document.getElementById('fecha').value = new Date().toISOString().split('T')[0];
            document.getElementById('fechaMasiva').value = new Date().toISOString().split('T')[0];
            
            // Establecer fechas por defecto para estad√≠sticas
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            document.getElementById('fechaDesde').value = firstDay.toISOString().split('T')[0];
            document.getElementById('fechaHasta').value = today.toISOString().split('T')[0];
            
            // Establecer fechas por defecto para trabajadores por cargo
            document.getElementById('fechaInicioCargo').value = firstDay.toISOString().split('T')[0];
            document.getElementById('fechaFinCargo').value = today.toISOString().split('T')[0];
        });

        // Funciones de navegaci√≥n
        function showTab(tabName) {
            // Ocultar todas las pesta√±as
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar la pesta√±a seleccionada
            document.getElementById(tabName).classList.add('active');
            
            // Actualizar botones
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            // Cargar datos si es necesario
            if (tabName === 'trabajadores' || tabName === 'datos' || tabName === 'estadisticas') {
                loadData();
            }
        }

        function showSubTab(subtabName) {
            document.querySelectorAll('.sub-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            if (document.getElementById(subtabName)) {
                document.getElementById(subtabName).classList.add('active');
            }
            
            // Actualizar botones de sub-pesta√±as
            event.target.parentElement.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
        }

        // Funciones de configuraci√≥n
        function saveConfig() {
            const url = document.getElementById('apiUrl').value;
            if (!url) {
                showNotification('Por favor ingresa la URL de tu Web App', 'error');
                return;
            }
            
            localStorage.setItem('sheets_api_url', url);
            API_URL = url;
            
            testConnection();
        }

        function loadConfig() {
            const savedUrl = localStorage.getItem('sheets_api_url');
            if (savedUrl) {
                document.getElementById('apiUrl').value = savedUrl;
                API_URL = savedUrl;
                testConnection();
            }
        }

        async function testConnection() {
            if (!API_URL) {
                document.getElementById('connectionStatus').innerHTML = 
                    '<div class="notification error">‚ö†Ô∏è Configuraci√≥n Requerida</div>';
                return;
            }

            document.getElementById('connectionStatus').innerHTML = 
                '<div class="notification info">üîÑ Probando conexi√≥n...</div>';

            try {
                const response = await fetch(`${API_URL}?action=getTrabajadores`);
                const data = await response.json();
                
                document.getElementById('connectionStatus').innerHTML = 
                    '<div class="notification success">‚úÖ Conexi√≥n exitosa con Google Sheets</div>';
                
                loadData();
            } catch (error) {
                document.getElementById('connectionStatus').innerHTML = 
                    '<div class="notification error">‚ùå Error de conexi√≥n: Verifica tu URL</div>';
            }
        }

        // Cargar datos desde Google Sheets
        async function loadData() {
            if (!API_URL) {
                showNotification('Primero configura la conexi√≥n con Google Sheets', 'error');
                return;
            }

            try {
                // Cargar trabajadores
                const trabajadoresResponse = await fetch(`${API_URL}?action=getTrabajadores`);
                trabajadores = await trabajadoresResponse.json();
                
                // Cargar registros
                const registrosResponse = await fetch(`${API_URL}?action=getRegistros`);
                registros = await registrosResponse.json();
                
                updateTrabajadoresTable();
                updateTrabajadoresSelect();
                updateRegistrosTable();
                updateWorkersList();
                
                showNotification('Datos sincronizados correctamente', 'success');
            } catch (error) {
                showNotification('Error al cargar datos', 'error');
                console.error(error);
            }
        }

        // Actualizar tabla de trabajadores
        function updateTrabajadoresTable() {
            const tbody = document.getElementById('bodyTrabajadores');
            tbody.innerHTML = '';
            
            trabajadores.forEach(trabajador => {
                const [cedula, nombre, cargo, tipoCargo, fechaIngreso, fechaRetiro] = trabajador;
                const estado = fechaRetiro ? 'Retirado' : 'Activo';
                const estadoClass = fechaRetiro ? 'text-danger' : 'text-success';
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${cedula}</td>
                    <td>${nombre}</td>
                    <td>${cargo}</td>
                    <td><span class="badge ${tipoCargo === 'Directa' ? 'badge-primary' : 'badge-secondary'}">${tipoCargo}</span></td>
                    <td>${fechaIngreso}</td>
                    <td>${fechaRetiro || '-'}</td>
                    <td><span class="${estadoClass}">${estado}</span></td>
                    <td>
                        <button onclick="editTrabajador('${cedula}')" class="btn btn-warning btn-sm">‚úèÔ∏è</button>
                        <button onclick="deleteTrabajador('${cedula}')" class="btn btn-danger btn-sm">üóëÔ∏è</button>
                    </td>
                `;
            });
        }

        // Actualizar select de trabajadores
        function updateTrabajadoresSelect() {
            const select = document.getElementById('trabajador');
            select.innerHTML = '<option value="">-- Seleccione un trabajador --</option>';
            
            trabajadores.filter(t => !t[5]).forEach(trabajador => { // Solo trabajadores activos
                const [cedula, nombre] = trabajador;
                select.innerHTML += `<option value="${cedula}">${nombre} (${cedula})</option>`;
            });
        }

        // Actualizar lista de trabajadores para registro masivo
        function updateWorkersList() {
            const container = document.getElementById('workersList');
            container.innerHTML = '';
            
            trabajadores.filter(t => !t[5]).forEach(trabajador => {
                const [cedula, nombre] = trabajador;
                container.innerHTML += `
                    <div style="margin-bottom: 8px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" value="${cedula}" style="margin-right: 10px;">
                            ${nombre} (${cedula})
                        </label>
                    </div>
                `;
            });
        }

        // Funciones para registro masivo
        function selectAllWorkers() {
            document.querySelectorAll('#workersList input[type="checkbox"]').forEach(cb => cb.checked = true);
        }

        function deselectAllWorkers() {
            document.querySelectorAll('#workersList input[type="checkbox"]').forEach(cb => cb.checked = false);
        }

        function cancelMasivo() {
            document.getElementById('fechaMasiva').value = '';
            document.getElementById('frenteMasivo').value = '';
            deselectAllWorkers();
        }

        // Agregar registro individual
        async function addRegistro() {
            const fecha = document.getElementById('fecha').value;
            const trabajadorCedula = document.getElementById('trabajador').value;
            const frente = document.getElementById('frente').value;
            const horasDirecta = document.getElementById('horasDirecta').value;
            const horasIndirecta = document.getElementById('horasIndirecta').value;

            if (!fecha || !trabajadorCedula || !frente) {
                showNotification('Por favor completa todos los campos obligatorios', 'error');
                return;
            }

            const trabajador = trabajadores.find(t => t[0] === trabajadorCedula);
            if (!trabajador) {
                showNotification('Trabajador no encontrado', 'error');
                return;
            }

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'addRegistro',
                        id: 'REG_' + Date.now(),
                        fecha: fecha,
                        trabajadorNombre: trabajador[1],
                        trabajadorCedula: trabajadorCedula,
                        frente: frente,
                        horasDirecta: parseFloat(horasDirecta) || 0,
                        horasIndirecta: parseFloat(horasIndirecta) || 0
                    })
                });

                const result = await response.json();
                if (result.success) {
                    showNotification('Registro agregado exitosamente', 'success');
                    clearRegistroForm();
                    loadData();
                } else {
                    showNotification('Error al agregar registro', 'error');
                }
            } catch (error) {
                showNotification('Error de conexi√≥n', 'error');
                console.error(error);
            }
        }

        // Limpiar formulario de registro
        function clearRegistroForm() {
            document.getElementById('trabajador').value = '';
            document.getElementById('frente').value = '';
            document.getElementById('horasDirecta').value = '';
            document.getElementById('horasIndirecta').value = '';
        }

        // Registro masivo
        async function addRegistroMasivo() {
            const fecha = document.getElementById('fechaMasiva').value;
            const frente = document.getElementById('frenteMasivo').value;
            const horasDirecta = document.getElementById('horasDirectaMasiva').value;
            const horasIndirecta = document.getElementById('horasIndirectaMasiva').value;

            const selectedWorkers = Array.from(document.querySelectorAll('#workersList input[type="checkbox"]:checked'));

            if (!fecha || !frente || selectedWorkers.length === 0) {
                showNotification('Por favor completa todos los campos y selecciona trabajadores', 'error');
                return;
            }

            const loadingMsg = showNotification('Guardando registros...', 'info');

            let successCount = 0;
            let errorCount = 0;

            for (const checkbox of selectedWorkers) {
                const trabajadorCedula = checkbox.value;
                const trabajador = trabajadores.find(t => t[0] === trabajadorCedula);

                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'addRegistro',
                            id: 'REG_' + Date.now() + '_' + Math.random(),
                            fecha: fecha,
                            trabajadorNombre: trabajador[1],
                            trabajadorCedula: trabajadorCedula,
                            frente: frente,
                            horasDirecta: parseFloat(horasDirecta) || 0,
                            horasIndirecta: parseFloat(horasIndirecta) || 0
                        })
                    });

                    const result = await response.json();
                    if (result.success) {
                        successCount++;
                    } else {
                        errorCount++;
                    }
                } catch (error) {
                    errorCount++;
                }
            }

            if (loadingMsg) loadingMsg.remove();

            if (errorCount === 0) {
                showNotification(`${successCount} registros agregados exitosamente`, 'success');
                cancelMasivo();
                loadData();
            } else {
                showNotification(`${successCount} exitosos, ${errorCount} fallaron`, 'error');
            }
        }

        // Actualizar tabla de registros
        function updateRegistrosTable() {
            const tbody = document.getElementById('bodyRegistros');
            tbody.innerHTML = '';
            
            registros.forEach((registro, index) => {
                const [id, fecha, trabajador, cedula, frente, horasDirecta, horasIndirecta] = registro;
                const totalHoras = (parseFloat(horasDirecta) || 0) + (parseFloat(horasIndirecta) || 0);
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${new Date(fecha).toLocaleDateString()}</td>
                    <td>${trabajador}</td>
                    <td>${cedula}</td>
                    <td>${frente}</td>
                    <td class="text-center">${horasDirecta}</td>
                    <td class="text-center">${horasIndirecta}</td>
                    <td class="text-center"><strong>${totalHoras}</strong></td>
                    <td>
                        <button onclick="deleteRegistro('${id || index}', '${fecha}', '${cedula}', '${frente}')" 
                                class="btn btn-danger btn-sm">üóëÔ∏è</button>
                    </td>
                `;
            });
        }

        // Eliminar registro
        async function deleteRegistro(id, fecha, cedula, frente) {
            if (!confirm('¬øEst√°s seguro de eliminar este registro?')) return;

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'deleteRegistro',
                        id: id,
                        fecha: fecha,
                        cedula: cedula,
                        frente: frente
                    })
                });

                const result = await response.json();
                if (result.success) {
                    showNotification('Registro eliminado exitosamente', 'success');
                    loadData();
                } else {
                    showNotification('Error al eliminar registro', 'error');
                }
            } catch (error) {
                showNotification('Error de conexi√≥n', 'error');
                console.error(error);
            }
        }

        // Funciones para trabajadores
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            if (modalId === 'modalTrabajador' && !editingWorker) {
                clearTrabajadorForm();
            }
        }

        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            editingWorker = null;
        }

        function clearTrabajadorForm() {
            document.getElementById('modalTitle').textContent = 'Nuevo Trabajador';
            document.getElementById('modalCedula').value = '';
            document.getElementById('modalNombre').value = '';
            document.getElementById('modalCargo').value = '';
            document.getElementById('modalTipoCargo').value = '';
            document.getElementById('modalFechaIngreso').value = '';
            document.getElementById('modalFechaRetiro').value = '';
            document.getElementById('modalCedula').disabled = false;
        }

        async function saveTrabajador() {
            const cedula = document.getElementById('modalCedula').value;
            const nombre = document.getElementById('modalNombre').value;
            const cargo = document.getElementById('modalCargo').value;
            const tipoCargo = document.getElementById('modalTipoCargo').value;
            const fechaIngreso = document.getElementById('modalFechaIngreso').value;
            const fechaRetiro = document.getElementById('modalFechaRetiro').value;

            if (!cedula || !nombre || !cargo || !tipoCargo || !fechaIngreso) {
                showNotification('Por favor completa todos los campos obligatorios', 'error');
                return;
            }

            try {
                const action = editingWorker ? 'updateTrabajador' : 'addTrabajador';
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: action,
                        cedula: cedula,
                        nombreCompleto: nombre,
                        cargo: cargo,
                        tipoCargo: tipoCargo,
                        fechaIngreso: fechaIngreso,
                        fechaRetiro: fechaRetiro
                    })
                });

                const result = await response.json();
                if (result.success) {
                    showNotification(`Trabajador ${editingWorker ? 'actualizado' : 'agregado'} exitosamente`, 'success');
                    hideModal('modalTrabajador');
                    loadData();
                } else {
                    showNotification('Error al guardar trabajador', 'error');
                }
            } catch (error) {
                showNotification('Error de conexi√≥n', 'error');
                console.error(error);
            }
        }

        function editTrabajador(cedula) {
            const trabajador = trabajadores.find(t => t[0] === cedula);
            if (!trabajador) return;

            editingWorker = cedula;
            document.getElementById('modalTitle').textContent = 'Editar Trabajador';
            document.getElementById('modalCedula').value = trabajador[0];
            document.getElementById('modalNombre').value = trabajador[1];
            document.getElementById('modalCargo').value = trabajador[2];
            document.getElementById('modalTipoCargo').value = trabajador[3];
            document.getElementById('modalFechaIngreso').value = trabajador[4];
            document.getElementById('modalFechaRetiro').value = trabajador[5] || '';
            document.getElementById('modalCedula').disabled = true;
            
            showModal('modalTrabajador');
        }

        async function deleteTrabajador(cedula) {
            if (!confirm('¬øEst√°s seguro de eliminar este trabajador?')) return;

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'deleteTrabajador',
                        cedula: cedula
                    })
                });

                const result = await response.json();
                if (result.success) {
                    showNotification('Trabajador eliminado exitosamente', 'success');
                    loadData();
                } else {
                    showNotification('Error al eliminar trabajador', 'error');
                }
            } catch (error) {
                showNotification('Error de conexi√≥n', 'error');
                console.error(error);
            }
        }

        // Funciones para estad√≠sticas
        function updateStats() {
            const fechaDesde = document.getElementById('fechaDesde').value;
            const fechaHasta = document.getElementById('fechaHasta').value;
            
            if (!fechaDesde || !fechaHasta) {
                showNotification('Por favor selecciona las fechas', 'error');
                return;
            }

            const registrosFiltrados = registros.filter(registro => {
                const fechaRegistro = new Date(registro[1]);
                const desde = new Date(fechaDesde);
                const hasta = new Date(fechaHasta);
                return fechaRegistro >= desde && fechaRegistro <= hasta;
            });

            const estadisticasPorFrente = {};
            
            registrosFiltrados.forEach(registro => {
                const [id, fecha, trabajador, cedula, frente, horasDirecta, horasIndirecta] = registro;
                
                if (!estadisticasPorFrente[frente]) {
                    estadisticasPorFrente[frente] = {
                        personal: new Set(),
                        horasDirecta: 0,
                        horasIndirecta: 0
                    };
                }
                
                estadisticasPorFrente[frente].personal.add(cedula);
                estadisticasPorFrente[frente].horasDirecta += parseFloat(horasDirecta) || 0;
                estadisticasPorFrente[frente].horasIndirecta += parseFloat(horasIndirecta) || 0;
            });

            const tbody = document.getElementById('bodyEstadisticas');
            tbody.innerHTML = '';

            Object.keys(estadisticasPorFrente).forEach(frente => {
                const stats = estadisticasPorFrente[frente];
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${frente}</strong></td>
                    <td class="text-center">${stats.personal.size}</td>
                    <td class="text-center">${stats.horasDirecta.toFixed(1)}</td>
                    <td class="text-center">${stats.horasIndirecta.toFixed(1)}</td>
                    <td class="text-center">-</td>
                    <td class="text-center">-</td>
                    <td class="text-center">-</td>
                    <td class="text-center">-</td>
                `;
            });
        }

        // NUEVAS FUNCIONES para Trabajadores por Cargo

        // Funci√≥n para consultar trabajadores por cargo
        async function consultarTrabajadoresPorCargo() {
            const fechaInicio = document.getElementById('fechaInicioCargo').value;
            const fechaFin = document.getElementById('fechaFinCargo').value;
            
            if (!fechaInicio || !fechaFin) {
                showNotification('Por favor selecciona ambas fechas', 'error');
                return;
            }
            
            if (new Date(fechaInicio) > new Date(fechaFin)) {
                showNotification('La fecha de inicio no puede ser mayor a la fecha final', 'error');
                return;
            }
            
            const loadingMsg = showNotification('Consultando datos...', 'info');
            
            try {
                const url = `${API_URL}?action=getTrabajadoresPorCargo&fechaInicio=${fechaInicio}&fechaFin=${fechaFin}`;
                const response = await fetch(url);
                const result = await response.json();
                
                if (result.success) {
                    mostrarResultadosTrabajadoresCargo(result);
                    showNotification('Consulta realizada exitosamente', 'success');
                } else {
                    throw new Error('Error en la consulta');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error al consultar los datos', 'error');
            } finally {
                if (loadingMsg) loadingMsg.remove();
            }
        }

        // Funci√≥n para mostrar los resultados
        function mostrarResultadosTrabajadoresCargo(result) {
            const tbody = document.getElementById('bodyTrabajadoresCargo');
            const resumen = document.getElementById('resumenCargo');
            
            // Actualizar resumen
            document.getElementById('totalTrabajadoresConsulta').textContent = result.totalTrabajadores;
            document.getElementById('totalCargosDiferentes').textContent = result.data.length;
            document.getElementById('rangoFechasConsulta').textContent = 
                `${formatDate(result.periodo.inicio)} - ${formatDate(result.periodo.fin)}`;
            
            resumen.style.display = 'flex';
            
            // Limpiar tabla
            tbody.innerHTML = '';
            
            if (result.data.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center">
                            No se encontraron trabajadores activos en el per√≠odo seleccionado
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Llenar tabla
            let totalDirecta = 0;
            let totalIndirecta = 0;
            
            result.data.forEach(item => {
                totalDirecta += item.directa;
                totalIndirecta += item.indirecta;
                
                const porcentajeDirecta = ((item.directa / item.total) * 100).toFixed(1);
                const porcentajeIndirecta = ((item.indirecta / item.total) * 100).toFixed(1);
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${item.cargo}</strong></td>
                    <td class="text-center">${item.directa}</td>
                    <td class="text-center">${item.indirecta}</td>
                    <td class="text-center"><strong>${item.total}</strong></td>
                    <td class="text-center">${porcentajeDirecta}%</td>
                    <td class="text-center">${porcentajeIndirecta}%</td>
                `;
            });
            
            // Fila de totales
            const totalRow = tbody.insertRow();
            totalRow.className = 'total-row';
            totalRow.innerHTML = `
                <td><strong>TOTAL</strong></td>
                <td class="text-center"><strong>${totalDirecta}</strong></td>
                <td class="text-center"><strong>${totalIndirecta}</strong></td>
                <td class="text-center"><strong>${totalDirecta + totalIndirecta}</strong></td>
                <td class="text-center"><strong>${((totalDirecta / (totalDirecta + totalIndirecta)) * 100).toFixed(1)}%</strong></td>
                <td class="text-center"><strong>${((totalIndirecta / (totalDirecta + totalIndirecta)) * 100).toFixed(1)}%</strong></td>
            `;
        }

        // Funci√≥n para exportar a Excel
        function exportarTrabajadoresCargo() {
            const tabla = document.getElementById('tablaTrabajadoresCargo');
            const fechaInicio = document.getElementById('fechaInicioCargo').value;
            const fechaFin = document.getElementById('fechaFinCargo').value;
            
            if (!tabla.querySelector('tbody tr td:not([colspan])')) {
                showNotification('No hay datos para exportar. Realiza una consulta primero.', 'error');
                return;
            }
            
            // Crear nombre del archivo
            const nombreArchivo = `Trabajadores_por_Cargo_${fechaInicio}_${fechaFin}.xlsx`;
            
            // Funci√≥n simple para exportar tabla a CSV (ya que no tenemos librer√≠a Excel)
            let csv = '';
            
            // Agregar encabezados
            const headers = tabla.querySelectorAll('thead th');
            headers.forEach((header, index) => {
                csv += header.textContent;
                if (index < headers.length - 1) csv += ',';
            });
            csv += '\n';
            
            // Agregar filas de datos
            const rows = tabla.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                cells.forEach((cell, index) => {
                    csv += cell.textContent.replace(',', ';');
                    if (index < cells.length - 1) csv += ',';
                });
                csv += '\n';
            });
            
            // Descargar archivo
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = nombreArchivo.replace('.xlsx', '.csv');
            a.click();
            window.URL.revokeObjectURL(url);
            
            showNotification('Archivo exportado exitosamente', 'success');
        }

        // Funci√≥n auxiliar para formatear fecha
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('es-ES');
        }

        // Funci√≥n para mostrar notificaciones
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
            
            return notification;
        }

        // Funci√≥n para crear plantilla
        function createTemplate() {
            showNotification('Funci√≥n de creaci√≥n de plantilla a√∫n no implementada', 'info');
        }

        // Funci√≥n para importar Excel
        function importExcel() {
            showNotification('Funci√≥n de importaci√≥n de Excel a√∫n no implementada', 'info');
        }

        // Estilos adicionales para modal
        const modalStyles = `
            <style>
                .modal {
                    position: fixed;
                    z-index: 1000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.5);
                }
                
                .modal-content {
                    background-color: white;
                    margin: 5% auto;
                    padding: 0;
                    border-radius: 10px;
                    width: 90%;
                    max-width: 500px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                }
                
                .modal-header {
                    padding: 20px;
                    border-bottom: 1px solid #eee;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                
                .modal-body {
                    padding: 20px;
                }
                
                .modal-footer {
                    padding: 20px;
                    border-top: 1px solid #eee;
                    display: flex;
                    gap: 10px;
                    justify-content: flex-end;
                }
                
                .close {
                    font-size: 24px;
                    font-weight: bold;
                    cursor: pointer;
                    color: #999;
                }
                
                .close:hover {
                    color: #000;
                }
                
                .badge {
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-size: 12px;
                    font-weight: bold;
                }
                
                .badge-primary { background: #007bff; color: white; }
                .badge-secondary { background: #6c757d; color: white; }
                .text-success { color: #28a745; }
                .text-danger { color: #dc3545; }
                .btn-sm { padding: 6px 12px; font-size: 12px; }
            </style>
        `;
        
        document.head.insertAdjacentHTML('beforeend', modalStyles);
    </script>
</body>
</html>
